name: Loom to slack

on:
  workflow_call: # Enable workflow reuse/import
  pull_request:
    types:
      - closed

jobs:
  post:
    if: github.event.pull_request.merged

    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Find first loom
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: bash .github/workflows/loom-get.sh ${{ github.event.pull_request.number }}

      - uses: rtCamp/action-slack-notify@v2
        if: env.LOOM_LINK
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
          SLACK_CHANNEL: sprint-demo
          SLACK_MESSAGE: ${{ env.LOOM_LINK }}
          SLACK_FOOTER: |
            *${{ github.event.pull_request.title }}*
            ${{ github.event.pull_request.html_url }}
          MSG_MINIMAL: true
